<?phpinclude 'variables.php';if (session_is_registered("authentification")){ // v&eacute;rification sur la session authentification 	/*		********************************************************************************************		CONFIGURATION		********************************************************************************************	*/	// copie ? (envoie une copie au visiteur)	$copie = 'oui';
	// Action du formulaire (si votre page a des parametres dans l'URL)	// si cette page est index.php?page=contact alors mettez index.php?page=contact	// sinon, laissez vide	$form_action = 'index.php?a=9';
	// Messages de confirmation du mail	$message_envoye = "Votre message nous est bien parvenu !";	$message_non_envoye = "L'envoi du mail a echoue, veuillez reessayer SVP.";
	// Message d'erreur du formulaire	$message_formulaire_invalide = "Verifiez que tous les champs soient bien remplis et que l'email soit sans erreur.";
	/*		********************************************************************************************		FIN DE LA CONFIGURATION		********************************************************************************************	*/
	/*	 * cette fonction sert à nettoyer et enregistrer un texte	 */	function Rec($text)	{		$text = trim($text); // delete white spaces after & before text		if (1 === get_magic_quotes_gpc())		{			$stripslashes = create_function('$txt', 'return stripslashes($txt);');		}		else		{			$stripslashes = create_function('$txt', 'return $txt;');		}		// magic quotes ?		$text = $stripslashes($text);		$text = htmlspecialchars($text, ENT_QUOTES); // converts to string with " and ' as well		$text = nl2br($text);		return $text;	};	/*	 * Cette fonction sert à verifier la syntaxe d'un email	 */	function IsEmail($email)	{		$pattern = "^([a-z0-9_]|\\-|\\.)+@(([a-z0-9_]|\\-)+\\.)+[a-z]{2,7}$";		return (eregi($pattern,$email)) ? true : false;	};	$err_formulaire = false; // sert pour remplir le formulaire en cas d'erreur si besoin	// si formulaire envoye, on recupere tous les champs. Sinon, on initialise les variables.	$nom     = (isset($_POST['nom']))     ? Rec($_POST['nom'])     : '';	$email   = (isset($_POST['email']))   ? Rec($_POST['email'])   : '';	$objet   = (isset($_POST['objet']))   ? Rec($_POST['objet'])   : '';	$message = (isset($_POST['message'])) ? Rec($_POST['message']) : '';	if (isset($_POST['envoi']))	{		// On va verifier les variables et l'email ...		$email = (IsEmail($email)) ? $email : ''; // soit l'email est vide si errone, soit il vaut l'email entre		$err_formulaire = (IsEmail($email)) ? false : true;		if (($nom != '') && ($email != '') && ($objet != '') && ($message != ''))		{			// les 4 variables sont remplies, on genere puis envoie le mail			$headers = 'From: '.$nom.' <'.$email.'>' . "\r\n";			// envoyer une copie au visiteur ?			if ($copie == 'oui')			{		$cible = Destinataire_INI_Conf().','.$email;			}			else			{		$cible = Destinataire_INI_Conf();			};			// Remplacement de certains caracteres speciaux			$message = html_entity_decode($message);			$message = str_replace('&#039;',"'",$message);			$message = str_replace('&#8217;',"'",$message);			$message = str_replace('<br>','',$message);			$message = str_replace('<br />','',$message);			// Envoi du mail			$message = $message.' ==> Serveur Concerne --> '.INI_Conf("Parametre_OSMW","hostnameSSH").' *** Moteur OpenSim selectionne: '.INI_Conf_Moteur($_SESSION['opensim_select'],"name").' - '.INI_Conf_Moteur($_SESSION['opensim_select'],"version")." ***";			if (mail($cible, $objet, $message, $headers))			{				echo '<p>'.$message_envoye.'</p>'."\n";			}			else			{				echo '<p>'.$message_non_envoye.'</p>'."\n";		};		}		else		{			// une des 3 variables (ou plus) est vide ...			echo '<p>'.$message_formulaire_invalide.' <a href="index.php?a=9">Retour au formulaire</a></p>'."\n";			$err_formulaire = true;		};	}; // fin du if (!isset($_POST['envoi']))	if (($err_formulaire) || (!isset($_POST['envoi'])))	{	echo '<HR>';	$ligne1 = '<B>Contacter l\'assistance.</B>';	$ligne2 = '*** <u>Moteur OpenSim selectionne: </u>'.INI_Conf_Moteur($_SESSION['opensim_select'],"name").' - '.INI_Conf_Moteur($_SESSION['opensim_select'],"version").' ***';	echo '<div class="block" id="clean-gray"><button><CENTER>'.$ligne1.'<br>'.$ligne2.'</CENTER></button></div>';	echo '<hr>';			// afficher le formulaire		echo '<form id="contact" method="post" action="'.$form_action.'">'."\n";		echo '	<fieldset><legend>Vos coordonnees</legend>'."\n";		echo '		<p>'."\n";		echo '			<label for="nom">Nom :</label>'."\n";		echo '			<input type="text" id="nom" name="nom" value="'.stripslashes($nom).'" tabindex="1" />'."\n";		echo '		</p>'."\n";		echo '		<p>'."\n";		echo '			<label for="email">Email :</label>'."\n";		echo '			<input type="text" id="email" name="email" value="'.stripslashes($email).'" tabindex="2" />'."\n";		echo '		</p>'."\n";		echo '	</fieldset>'."\n";		echo '	<fieldset><legend>Votre message :</legend>'."\n";		echo '		<p>'."\n";		echo '			<label for="objet">Objet :</label>'."\n";		echo '			<input type="text" id="objet" name="objet" value="'.stripslashes($objet).'" tabindex="3" />'."\n";		echo '		</p>'."\n";		echo '		<p>'."\n";		echo '			<label for="message">Message :</label>'."\n";		echo '			<textarea id="message" name="message" tabindex="4" cols="40" rows="15" >'.stripslashes($message).'</textarea>'."\n";		echo '		</p>'."\n";		echo '	</fieldset>'."\n";		echo '	<div style="text-align:center;"><input type="submit" name="envoi" value="Envoyer le formulaire !" /></div>'."\n";		echo '</form>'."\n";	};	}else{header('Location: index.php');   }	?>
